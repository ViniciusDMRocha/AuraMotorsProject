<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Aura Motors</title>
    <link rel="stylesheet" href="./styles/listagemAnuncio.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <meta name="viewport" content="width=device-width, inicial-s">
  </head>

  <body>
      
    <header>
      <nav>
        <ul class="nav-links">
          <li class="home"><a href="menuRestrito.html"><img src="./images/logo.png" alt="logo"></a></li>
          
          <div class="anuncioOptions">
            <a href="cadastroVeiculo.html">Criar Anúncio</a>
            <a href="">Meus Anúncios</a>
          </div>
          
          <li class="liLogoff"><button class="logoff" id="logoff"><span class="material-symbols-outlined">
            account_circle
            </span>Logoff</button></li>
        </ul>
      </nav>
      <div class="hamburger" onclick="toggleMenu()">
        ☰
      </div>
    </header>

    <h3>Seus Anúncios:</h3>

    <div class="search">
      <select name="marca" id="filterMarca">
        <option value="" disabled selected>Marca</option>
        <option value="nissan">Nissan</option>
        <option value="honda">Honda</option>
        <option value="fiat">Fiat</option>
      </select>
      <select name="modelo" id="filterModelo">
        <option value="" disabled selected>Modelo</option>
        <option value="silvia">Silvia</option>
        <option value="palio">Palio</option>
        <option value="civic">Civic</option>
      </select>
      <select name="localizacao" id="filterLocal">
        <option value="" disabled selected>Localização</option>
        <option value="patos">Patos de Minas</option>
        <option value="uberlandia">Uberlândia</option>
        <option value="ituiutaba">Ituiutaba</option>
      </select>
    </div>
    <hr>

    <main id="meusCarros">
       
    </main>

    <footer>
      <address>
        Av. João Naves de Ávila, 2121 - Santa Mônica, Uberlândia - MG
      </address>
    </footer>

    <script src="./scripts/verifica.js"></script>

    <script>

        async function carregarMeusCarros() {
          try {
            const resposta = await fetch('./phpServer/controladorRestrito.php?acao=ListarMeusAnuncios');
            const carros = await resposta.json();

            const container = document.getElementById('meusCarros');
            container.innerHTML = ''; // Limpa o container antes de adicionar novos elementos

            carros.forEach(carro => {
              const card = document.createElement('div');
              card.className = 'card';

              card.innerHTML = `
                <img src="./images/${carro.imagem}" alt="${carro.modelo}">
                <h1>${carro.modelo}</h1>
                <div class="descricao">
                  <p><span class="material-symbols-outlined">car_tag</span> ${carro.marca}</p>
                  <p><span class="material-symbols-outlined">calendar_month</span> ${carro.ano}</p>
                  <p><span class="material-symbols-outlined">location_on</span> ${carro.localizacao}</p>
                </div>
                <div class="options">
                  <a href="detalhe.html?id=${carro.id}">Detalhes</a>
                  <a href="listagemInteresse.html?id=${carro.id}">Interesses</a>
                  <button class="lixeira" data-id="${carro.id}">Excluir</button>
                </div>
              `;

              container.appendChild(card);
            });

            // Adiciona o event listener para os botões de exclusão
            document.querySelectorAll('.lixeira').forEach(botao => {
              botao.addEventListener('click', async () => {
                const id = botao.getAttribute('data-id');
                if (confirm('Tem certeza que deseja excluir este anúncio?')) {
                  try {
                    const resposta = await fetch(`./phpServer/controladorRestrito.php?acao=excluirAnuncio&id=${id}`);
                    const resultado = await resposta.text();
                    alert(resultado);
                    carregarMeusCarros(); // Recarrega os carros após exclusão
                  } catch (erro) {
                    console.error("Erro ao excluir o anúncio:", erro);
                  }
                }
              });
            });

          } catch (erro) {
            console.error("Erro ao carregar os carros:", erro);
          }
        }

        function toggleMenu() {

            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');

            document.addEventListener('click', function(event) {
                const nav = document.querySelector('.nav-links');
                const hamburger = document.querySelector('.hamburger');

                if (!nav.contains(event.target) && !hamburger.contains(event.target)) {
                    nav.classList.remove('active');
                }
            })

        }

        window.addEventListener('load', () => {
          const buttonLogoff = document.querySelector('#logoff');
          buttonLogoff.onclick = async () => {
              try {
                  const response = await fetch("./phpServer/controladorRestrito.php?acao=logout");
                  if (!response.ok) throw new Error(response.statusText);
                  window.location = "./index.html";
              } catch (e) {
                  console.error(e);
              }
          };
        });

        carregarMeusCarros();

    </script>

  </body>
</html>
